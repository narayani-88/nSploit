<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nSploit - Metasploit Module Organizer</title>
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" href="favicon.ico">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container-fluid {
            padding: 20px;
        }
        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .search-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        .results-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-height: 70vh;
            overflow-y: auto;
        }
        .module-card {
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: white;
        }
        .module-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: #007bff;
        }
        .module-path {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            border-left: 4px solid #007bff;
        }
        .category-badge {
            font-size: 0.8em;
            padding: 4px 8px;
            border-radius: 12px;
        }
        .usage-code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            white-space: pre-line;
            margin-top: 10px;
        }
        .tag {
            background: #e9ecef;
            color: #495057;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            margin: 2px;
            display: inline-block;
        }
        .stats-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            color: rgb(0, 0, 0);
            margin-bottom: 15px;
        }
        .btn-copy {
            background: #28a745;
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background 0.3s;
        }
        .btn-copy:hover {
            background: #218838;
        }
        .search-input {
            border-radius: 25px;
            padding: 12px 20px;
            border: 2px solid #e0e0e0;
            transition: border-color 0.3s;
        }
        .search-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        .filter-select {
            border-radius: 10px;
            padding: 8px 15px;
        }
        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }
        .logo-svg {
            width: 300px;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="header text-center">
            <div class="logo-container">
                <svg class="logo-svg" viewBox="0 0 400 120" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#1e3c72;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#2a5298;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    
                    <!-- Background -->
                    <rect width="400" height="120" fill="url(#bgGradient)" rx="10"/>
                    
                    <!-- Shield outline -->
                    <path d="M25 25 L25 55 Q25 75 40 85 L55 95 Q60 97 65 95 L80 85 Q95 75 95 55 L95 25 Q95 20 90 20 L30 20 Q25 20 25 25 Z" 
                          fill="none" stroke="#00bcd4" stroke-width="3"/>
                    
                    <!-- Network/Circuit design inside shield -->
                    <!-- Main vertical line -->
                    <line x1="60" y1="35" x2="60" y2="75" stroke="#4caf50" stroke-width="4" stroke-linecap="round"/>
                    
                    <!-- Branch lines -->
                    <line x1="60" y1="45" x2="75" y2="40" stroke="#4caf50" stroke-width="3" stroke-linecap="round"/>
                    <line x1="60" y1="55" x2="45" y2="50" stroke="#4caf50" stroke-width="3" stroke-linecap="round"/>
                    <line x1="60" y1="65" x2="75" y2="70" stroke="#4caf50" stroke-width="3" stroke-linecap="round"/>
                    
                    <!-- Nodes/circles -->
                    <circle cx="60" cy="35" r="4" fill="#4caf50"/>
                    <circle cx="75" cy="40" r="4" fill="#4caf50"/>
                    <circle cx="45" cy="50" r="4" fill="#4caf50"/>
                    <circle cx="75" cy="70" r="4" fill="#4caf50"/>
                    <circle cx="60" cy="75" r="4" fill="#4caf50"/>
                    
                    <!-- Text "nSploit" -->
                    <text x="120" y="70" font-family="Arial, sans-serif" font-size="36" font-weight="bold" fill="white">nSploit</text>
                </svg>
            </div>
            <p class="text-white-50 mb-0">Find the right Metasploit module for your penetration testing needs</p>
        </div>

        <div class="row">
            <!-- Search Panel -->
            <div class="col-md-4">
                <div class="search-panel">
                    <h4 class="mb-4"><i class="fas fa-search"></i> Search & Filter</h4>
                    
                    <!-- Search Input -->
                    <div class="mb-3">
                        <label class="form-label">Search Query</label>
                        <input type="text" id="searchQuery" class="form-control search-input" 
                               placeholder="e.g., port scan, smb, vulnerability...">
                    </div>

                    <!-- Category Filter -->
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select id="categoryFilter" class="form-select filter-select">
                            <option value="">All Categories</option>
                        </select>
                    </div>

                    <!-- Target Filter -->
                    <div class="mb-3">
                        <label class="form-label">Target Type</label>
                        <select id="targetFilter" class="form-select filter-select">
                            <option value="">All Targets</option>
                        </select>
                    </div>

                    <!-- Search Button -->
                    <button id="searchBtn" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> Search Modules
                    </button>

                    <!-- Quick Actions -->
                    <div class="mt-4">
                        <h6>Quick Actions</h6>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-sm" onclick="quickSearch('port scan')">
                                <i class="fas fa-network-wired"></i> Port Scanning
                            </button>
                            <button class="btn btn-outline-success btn-sm" onclick="quickSearch('smb')">
                                <i class="fab fa-windows"></i> SMB Modules
                            </button>
                            <button class="btn btn-outline-warning btn-sm" onclick="quickSearch('vulnerability')">
                                <i class="fas fa-bug"></i> Vulnerability Scanners
                            </button>
                            <button class="btn btn-outline-danger btn-sm" onclick="quickSearch('exploit')">
                                <i class="fas fa-bomb"></i> Exploits
                            </button>
                        </div>
                    </div>

                    <!-- Stats -->
                    <div class="mt-4">
                        <div class="stats-card">
                            <h6>Total Modules</h6>
                            <h4 id="totalModules">0</h4>
                        </div>
                        <div class="stats-card">
                            <h6>Search Results</h6>
                            <h4 id="resultCount">0</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Panel -->
            <div class="col-md-8">
                <div class="results-panel">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4><i class="fas fa-list"></i> Modules</h4>
                        <div>
                            <button id="clearBtn" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <div id="resultsContainer">
                        <div class="text-center text-muted">
                            <i class="fas fa-search fa-3x mb-3"></i>
                            <p>Enter a search query or select a category to find modules</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="modules_data.js?v=3.1" onerror="console.error('Failed to load modules_data.js')"></script>
    <script>
        let allModules = [];
        
        // Fallback modules in case external file fails to load
        const FALLBACK_MODULES = [
            {
                "name": "TCP Port Scanner",
                "path": "auxiliary/scanner/portscan/tcp",
                "category": "Port Scanning",
                "description": "Basic TCP port scanner to identify open ports",
                "targets": ["Any", "Network"],
                "tags": ["tcp", "port", "scan", "network", "reconnaissance"],
                "usage": "use auxiliary/scanner/portscan/tcp\nset RHOSTS target_ip\nset PORTS 1-1000\nrun",
                "options": ["RHOSTS", "PORTS", "THREADS", "TIMEOUT"]
            },
            {
                "name": "SMB Version Scanner",
                "path": "auxiliary/scanner/smb/smb_version",
                "category": "Service Scanning",
                "description": "Detect SMB version information",
                "targets": ["Windows", "Linux", "Network"],
                "tags": ["smb", "version", "scan", "windows"],
                "usage": "use auxiliary/scanner/smb/smb_version\nset RHOSTS target_ip\nrun",
                "options": ["RHOSTS", "THREADS"]
            }
        ];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Check if MODULES_DB is defined
                if (typeof MODULES_DB === 'undefined') {
                    console.warn('MODULES_DB is not defined. Using fallback modules.');
                    allModules = FALLBACK_MODULES;
                    showWarning('Using limited module set. Full database may not have loaded properly.');
                } else {
                    allModules = MODULES_DB;
                    console.log('Loaded', allModules.length, 'modules from external database');
                }
                
                loadCategories();
                loadTargets();
                document.getElementById('totalModules').textContent = allModules.length;
                
                // Event listeners
                document.getElementById('searchBtn').addEventListener('click', performSearch);
                document.getElementById('clearBtn').addEventListener('click', clearResults);
                document.getElementById('searchQuery').addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') performSearch();
                });
                
                console.log('nSploit initialized successfully');
            } catch (error) {
                console.error('Error initializing nSploit:', error);
                showError('Error initializing application: ' + error.message);
            }
        });

        // Show error message to user
        function showError(message) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = `
                <div class="text-center text-danger">
                    <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                    <h5>Error</h5>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="location.reload()">
                        <i class="fas fa-refresh"></i> Reload Page
                    </button>
                </div>
            `;
        }

        // Show warning message to user
        function showWarning(message) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = `
                <div class="text-center text-warning">
                    <i class="fas fa-exclamation-circle fa-3x mb-3"></i>
                    <h5>Warning</h5>
                    <p>${message}</p>
                    <p><small>You can still search the available modules below.</small></p>
                </div>
            `;
        }

        // Load categories
        function loadCategories() {
            try {
                if (!allModules || allModules.length === 0) {
                    console.error('No modules available for category loading');
                    return;
                }
                
                const categories = [...new Set(allModules.map(module => module.category))].sort();
                const select = document.getElementById('categoryFilter');
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    select.appendChild(option);
                });
                
                console.log('Loaded', categories.length, 'categories');
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // Load targets
        function loadTargets() {
            try {
                if (!allModules || allModules.length === 0) {
                    console.error('No modules available for target loading');
                    return;
                }
                
                const targets = [...new Set(allModules.flatMap(module => module.targets))].sort();
                const select = document.getElementById('targetFilter');
                
                targets.forEach(target => {
                    const option = document.createElement('option');
                    option.value = target;
                    option.textContent = target;
                    select.appendChild(option);
                });
                
                console.log('Loaded', targets.length, 'targets');
            } catch (error) {
                console.error('Error loading targets:', error);
            }
        }

        // Perform search
        function performSearch() {
            try {
                if (!allModules || allModules.length === 0) {
                    showError('No modules available for search. Please refresh the page.');
                    return;
                }
                
                const query = document.getElementById('searchQuery').value.toLowerCase();
                const category = document.getElementById('categoryFilter').value;
                const target = document.getElementById('targetFilter').value;

                let results = allModules.filter(module => {
                    // Filter by category if specified
                    if (category && module.category !== category) {
                        return false;
                    }
                    
                    // Filter by target type if specified
                    if (target && !module.targets.includes(target)) {
                        return false;
                    }
                    
                    // Search in name, description, and tags
                    if (query) {
                        const searchText = `${module.name} ${module.description} ${module.tags.join(' ')}`.toLowerCase();
                        if (!searchText.includes(query)) {
                            return false;
                        }
                    }
                    
                    return true;
                });
                
                console.log('Search completed:', results.length, 'results found');
                displayResults(results);
                document.getElementById('resultCount').textContent = results.length;
            } catch (error) {
                console.error('Error performing search:', error);
                showError('Error performing search: ' + error.message);
            }
        }

        // Quick search function
        function quickSearch(query) {
            document.getElementById('searchQuery').value = query;
            performSearch();
        }

        // Display results
        function displayResults(modules) {
            const container = document.getElementById('resultsContainer');
            
            if (modules.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted">
                        <i class="fas fa-exclamation-circle fa-3x mb-3"></i>
                        <p>No modules found matching your criteria</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = modules.map(module => `
                <div class="module-card">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="mb-0">${module.name}</h5>
                        <span class="badge category-badge bg-primary">${module.category}</span>
                    </div>
                    
                    <div class="module-path mb-3">
                        ${module.path}
                        <button class="btn-copy float-end" onclick="copyToClipboard('${module.path}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    
                    <p class="text-muted mb-3">${module.description}</p>
                    
                    <div class="mb-3">
                        <strong>Targets:</strong>
                        ${module.targets.map(target => `<span class="tag">${target}</span>`).join('')}
                    </div>
                    
                    <div class="mb-3">
                        <strong>Tags:</strong>
                        ${module.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    
                    <div class="mb-3">
                        <strong>Options:</strong> ${module.options.join(', ')}
                    </div>
                    
                    <details>
                        <summary class="btn btn-outline-info btn-sm">
                            <i class="fas fa-code"></i> Show Usage Example
                        </summary>
                        <div class="usage-code">${module.usage}</div>
                        <button class="btn-copy mt-2" onclick="copyToClipboard(\`${module.usage}\`)">
                            <i class="fas fa-copy"></i> Copy Usage
                        </button>
                    </details>
                </div>
            `).join('');
        }

        // Clear results
        function clearResults() {
            document.getElementById('searchQuery').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('targetFilter').value = '';
            document.getElementById('resultsContainer').innerHTML = `
                <div class="text-center text-muted">
                    <i class="fas fa-search fa-3x mb-3"></i>
                    <p>Enter a search query or select a category to find modules</p>
                </div>
            `;
            document.getElementById('resultCount').textContent = '0';
        }

        // Copy to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show success feedback
                const toast = document.createElement('div');
                toast.className = 'alert alert-success position-fixed';
                toast.style.top = '20px';
                toast.style.right = '20px';
                toast.style.zIndex = '9999';
                toast.innerHTML = '<i class="fas fa-check"></i> Copied to clipboard!';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 2000);
            });
        }
    </script>
</body>
</html>
